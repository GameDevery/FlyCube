#pragma once
#include <Context/Context.h>
#include <Context/Program.h>
#include <Context/BufferLayout.h>
#include <glm/glm.hpp>
#include <array>
#include <vector>
#include <memory>

struct {{ShaderName}}Desc
{
    static constexpr ShaderType type = {{ShaderType}};
    ShaderDesc desc = { "{{ShaderPath}}", "{{Entrypoint}}", type };{{#HasCBuffers}}

    struct CBV
    {
{{#CBuffers}}        NamedBindKey {{Name}} = { type, ViewType::kConstantBuffer, {{Slot}}, {{Space}}, "{{Name}}" };
{{/CBuffers}}    } cbv;{{/HasCBuffers}}{{#HasTextures}}

    struct SRV
    {
{{#Textures}}       NamedBindKey {{Name}} = { type, ViewType::kShaderResource, {{Slot}}, {{Space}}, "{{Name}}" };
{{/Textures}}    } srv;{{/HasTextures}}{{#HasUAVs}}

    struct UAV
    {
{{#UAVs}}       NamedBindKey {{Name}} = { type, ViewType::kUnorderedAccess, {{Slot}}, {{Space}}, "{{Name}}" };
{{/UAVs}}    } uav;{{/HasUAVs}}{{#HasInputs}}

    struct IA
    {
{{#Inputs}}        static constexpr const uint32_t {{Name}} = {{Slot}};
{{/Inputs}}    } ia;{{/HasInputs}}{{#HasOutputs}}

    struct OM
    {
{{#Outputs}}        NamedBindKey rtv{{Slot}} = { type, ViewType::kRenderTarget, {{Slot}}, 0, "{{Name}}" };
{{/Outputs}}        NamedBindKey dsv = { type, ViewType::kDepthStencil, 0, 0, "" };
    } om;{{/HasOutputs}}{{#HasSamplers}}

    struct Sampler
    {
{{#Samplers}}       NamedBindKey {{Name}} = { type, ViewType::kSampler, {{Slot}}, {{Space}}, "{{Name}}" };
{{/Samplers}}    } sampler;{{/HasSamplers}}
};

class {{ShaderName}} : public {{ShaderName}}Desc
{
public:{{#CBuffers}}
    struct {{BufferName}}
    {
{{#Variables}}        {{&Type}} {{Name}};
{{/Variables}}    };
{{/CBuffers}}{{#CBuffers}}
    BufferLayout {{BufferName}}_layout = {
        {{BufferSize}},
        { {{#Variables}}{{VariableSize}}, {{/Variables}} },
        { {{#Variables}}offsetof({{BufferName}}, {{Name}}), {{/Variables}} },
        { {{#Variables}}{{StartOffset}}, {{/Variables}} }
    };
{{/CBuffers}}{{#HasCBuffers}}
    struct Cbuffer
    {
        Cbuffer({{ShaderName}}& shader, Context& context){{#CBuffers}}
            {{BufferSeparator}} {{BufferName}}(context, shader.{{BufferName}}_layout){{/CBuffers}}
        {
        }
{{#CBuffers}}
        ConstantBuffer<{{BufferName}}> {{BufferName}};{{/CBuffers}}
    } cbuffer;

    {{ShaderName}}(Context& context)
        : cbuffer(*this, context)
    {
    }{{/HasCBuffers}}{{^HasCBuffers}}
    {{ShaderName}}(Context& context)
    {
    }{{/HasCBuffers}}

    std::shared_ptr<Shader> shader;
};
